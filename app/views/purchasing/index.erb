hello

<%= session[:foo] %>

<div class="popup">
  <div class="header">
    <a href="#">cancel</a>
  </div>
  <div class="payment">
<% if session[:purchased].nil?  %>
    <div class="step1">

      <div class="login hide" >
        <form id="frmlogin" method="post" action="">
          <label for="email">Email:</label>
          <input type="text" name="email" id="email" />
          <label for="password">Password:</label>
          <input type="password" name="password" id="password" />
          <label for="password_confirmation">Confirmation</label>
          <input type="password" name="password_confirmation" id="password_confirmation" />
          <input type="submit" value="login" />
        </form>
      </div>
      <div class="register">
        <form id="frmregister" method="post" action="">
          <label for="email">Email:</label>
          <input type="text" name="email" id="email" />
          <label for="password">Password:</label>
          <input type="password" name="password" id="password" />
          <label for="password_confirmation">Confirmation</label>
          <input type="password" name="password_confirmation" id="password_confirmation" />
          <input type="submit" value="login" />
        </form>
      </div>
    </div>
    <div class="step2 hide">
      <a href="<%= url_for :controller => 'purchasing', :action => 'checkout' %>">Buy Content</a>
    </div>
<% else %>
     purchased!
<% end %>
    
   
  </div>
</div>


<script type="text/javascript">
$(function()
{
  $("#frmregister").submit(function(evt)
  {
    $.ajax({
    url: '/users/register',
    data: {
      user: $("#frmregister").serializeObject()
    },
    type      : 'POST',
    dataType  : 'json',
    success   : function(resp)
    {
      $(".step1").fadeOut('fast',function()
      {
        $(".step2").fadeIn('fast');
      });
    }
  });
  evt.preventDefault();
  });


  $.fn.serializeObject = function()
  {
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name]) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
        } else {
            o[this.name] = this.value || '';
        }
    });
    return o;
  };

});


</script>